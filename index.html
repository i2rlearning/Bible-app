<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="css/menu.css" rel="stylesheet" />
  <link href="css/main.css" rel="stylesheet" />
  <link rel="icon" type="image/x-icon" href="/img/favicon.ico">
  <title>Branch of Israel - Bible App</title>
  <style>
    /* Optional minimal styles to make native select look ok */
    .subheader .custom-select select { width: 12vw; min-width: 180px; }
    .leftcol, .rightcol { position: fixed; top: 50%; transform: translateY(-50%); }
    .leftcol { left: 10px; }
    .rightcol { right: 10px; }
    .left-button, .right-button { width: 48px; height: auto; cursor: pointer; }
    .bottom-spacer { height: 64px; }
    .disabled { opacity: 0.4; pointer-events: none; }
    .list-container { display: grid; gap: 8px; margin-top: 12px; }
    .list-item { padding: 8px 10px; border: 1px solid #ddd; border-radius: 8px; }
    .align-group { display: inline-flex; align-items: center; gap: 6px; }
  </style>
</head>
<body class="index">
  <div class="subheader" id="stickyHeader">
    <div class="container flex">
      <div class="subheadings">
        <div class="column">
          <button type="button" aria-label="Open menu" style="font-size:25px;cursor:pointer;background:none;border:none;color:inherit" id="openMenuBtn">&#9776;</button>
        </div>
        <div class="column">
          <span style="color:lightgray;">Bible</span>
        </div>
        <div class="column">
          <span style="color:lightgray;">Book &amp; Chapter</span>
        </div>
        <div class="column">
          <div class="custom-select">
            <label for="optVal" class="visually-hidden">Choose language</label>
            <select id="optVal">
              <option value="">Bibles</option>
              <option value="https://api.scripture.api.bible/v1/bibles?language=eng&include-full-details=false">English</option>
              <option value="https://api.scripture.api.bible/v1/bibles?language=grc&include-full-details=false">Greek</option>
              <option value="https://api.scripture.api.bible/v1/bibles?ids=a8a97eebae3c98e4-01%2C2c500771ea16da93-01%2C0b262f1ed7f084a6-01&include-full-details=false">Hebrew</option>
              <option value="https://api.scripture.api.bible/v1/bibles?include-full-details=false">All</option>
            </select>
          </div>
        </div>
        <div class="column">
          <div class="align-group">
            <label for="font-size-slider">Font size:</label>
            <input type="range" id="font-size-slider" min="18" max="35" value="18">
          </div>
        </div>
      </div>
    </div>
  </div>

  <header>
    <div id="menuNav" class="overlay" aria-hidden="true">
      <button type="button" class="closebtn" style="color:red" id="closeMenuBtn" aria-label="Close menu">&times;</button>
      <nav class="overlay-content">
        <a href="#" class="current">Home</a>
        <a href="#" class="disabled" aria-disabled="true">Books</a>
        <a href="#" class="disabled" aria-disabled="true">Chapter</a>
        <a href="./search.html">Search</a>
        <a href="#">Settings</a>
      </nav>
    </div>
  </header>

  <main class="container" id="main" style="font-size: 18px;">
    <div id="bible-version-list" class="list-container"></div>

    <div class="leftcol">
      <a id="prevURL" href="#">
        <img id="imgleft" class="left-button" src="./img/orig_left_stamp.png" alt="Previous" />
      </a>
    </div>

    <div class="rightcol">
      <a id="nextURL" href="#">
        <img id="imgright" class="right-button" src="./img/orig_right_stamp.png" alt="Next" />
      </a>
    </div>

    <div class="bottom-spacer"></div>
  </main>

  <script src="js/my_key.js"></script>
  <script>
    // ======= Side Menu =======
    const menu = document.getElementById('menuNav');
    document.getElementById('openMenuBtn').addEventListener('click', () => {
      menu.style.width = '225px';
      menu.setAttribute('aria-hidden', 'false');
    });
    document.getElementById('closeMenuBtn').addEventListener('click', () => {
      menu.style.width = '0px';
      menu.setAttribute('aria-hidden', 'true');
    });

    // ======= Font resize slider =======
    const fontSizeSlider = document.getElementById("font-size-slider");
    const main = document.getElementById("main");
    fontSizeSlider.addEventListener("input", () => {
      main.style.fontSize = fontSizeSlider.value + "px";
    });

    // ======= Fetch helper (AJAX) =======
    async function fetchJSON(url) {
      const headers = { 'accept': 'application/json' };
      if (window.SCRIPTURE_API_KEY) {
        headers['api-key'] = window.SCRIPTURE_API_KEY;
      }
      const resp = await fetch(url, { headers, cache: 'no-store' });
      if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
      return resp.json();
    }

    // ======= Populate list =======
    const listEl = document.getElementById('bible-version-list');
    function renderList(items) {
      listEl.innerHTML = '';
      if (!items || !items.length) {
        listEl.innerHTML = '<div class="list-item">No results.</div>';
        return;
      }
      for (const b of items) {
        const div = document.createElement('div');
        div.className = 'list-item';
        div.innerHTML = `
          <strong>${b.name || 'Untitled'}</strong><br>
          <small>${b.language?.name || ''}${b.abbreviation ? ' • ' + b.abbreviation : ''}</small>
        `;
        listEl.appendChild(div);
      }
    }

    function renderError(message) {
      listEl.innerHTML = `<div class="list-item" style="border-color:#f2b; background:#fff5fa;">Error: ${message}</div>`;
    }

    async function loadBibles(url) {
      if (!url) { listEl.innerHTML = ''; return; }
      try {
        listEl.innerHTML = '<div class="list-item">Loading…</div>';
        const data = await fetchJSON(url);
        // API returns { data: [bibles…] }
        renderList(Array.isArray(data?.data) ? data.data : []);
      } catch (e) {
        renderError(e.message || 'Failed to load');
      }
    }

    // ======= Select change handler =======
    const select = document.getElementById('optVal');
    select.addEventListener('change', (e) => {
      const value = e.target.value;
      if (value && value.startsWith('http')) {
        loadBibles(value);
      } else {
        listEl.innerHTML = '';
      }
    });

    // Optionally: auto-load default selection if it’s preset
    if (select.value && select.value.startsWith('http')) {
      loadBibles(select.value);
    }

    // ======= Prev/Next handlers (stubbed) =======
    document.getElementById('prevURL').addEventListener('click', (e) => {
      e.preventDefault();
      // TODO: implement previous navigation logic
    });
    document.getElementById('nextURL').addEventListener('click', (e) => {
      e.preventDefault();
      // TODO: implement next navigation logic
    });

    // ======= Click outside to close menu (optional) =======
    document.addEventListener('click', (e) => {
      if (menu.style.width === '225px' && !menu.contains(e.target) && e.target.id !== 'openMenuBtn') {
        menu.style.width = '0px';
        menu.setAttribute('aria-hidden', 'true');
      }
    });
  </script>
</body>
</html>
